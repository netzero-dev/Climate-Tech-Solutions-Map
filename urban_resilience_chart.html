<!DOCTYPE html>
<html>
<head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/plotly.js/2.24.1/plotly.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <style>
        #chart { width: 1200px; height: 800px; margin: 0 auto; }
    </style>
</head>
<body>
    <div id="chart"></div>

    <script>
        async function createVisualization() {
            const response = await fetch('https://netzero-dev.github.io/Climate-Tech-Solutions-Map/climate_adaptation_solutions_full.csv');
            const csvText = await response.text();
            
            const rawData = Papa.parse(csvText, {
                header: true,
                skipEmptyLines: true
            }).data;

            // Process data for visualization
            const labels = [];
            const parents = [];
            const values = [];
            const customdata = [];
            const ids = [];

            // Get unique categories
            const categories = [...new Set(rawData.map(d => d.Category))];
            
            // Add categories
            categories.forEach(category => {
                if (category) {
                    labels.push(category);
                    parents.push('');
                    values.push(rawData.filter(d => d.Category === category).length);
                    customdata.push(`${rawData.filter(d => d.Category === category).length} solutions`);
                    ids.push(`cat-${category}`);
                }
            });

            // Add solutions
            rawData.forEach(row => {
                if (row.Category && row.Solution_Name) {
                    labels.push(row.Solution_Name);
                    parents.push(row.Category);
                    values.push(1);
                    ids.push(`sol-${row.Solution_Name}`);
                    customdata.push(
                        `<b>Source:</b> ${row.Source}<br>` +
                        `<b>Climate Problem:</b> ${row.Climate_Problem}<br>` +
                        `<b>Technologies:</b> ${row.Technologies}<br>` +
                        `<b>Description:</b> ${row.Description}`
                    );
                }
            });

            const data = [{
                type: 'sunburst',
                labels: labels,
                parents: parents,
                values: values,
                ids: ids,
                customdata: customdata,
                hovertemplate: '%{customdata}<extra></extra>',
                branchvalues: 'total',
                maxdepth: 3,
                marker: {
                    colors: [
                        '#FFB3BA', '#BAFFC9', '#BAE1FF', '#FFFFBA', 
                        '#FFB3FF', '#FFE4B5', '#E6E6FA', '#B2DFDB'
                    ]
                }
            }];

            const layout = {
                title: 'Climate Adaptation Solutions',
                width: 1200,
                height: 800,
                sunburstcolorway: [
                    '#FFB3BA', '#BAFFC9', '#BAE1FF', '#FFFFBA', 
                    '#FFB3FF', '#FFE4B5', '#E6E6FA', '#B2DFDB'
                ]
            };

            const config = {
                responsive: true,
                displayModeBar: false,
                showSendToCloud: false
            };

            Plotly.newPlot('chart', data, layout, config);
        }

        createVisualization().catch(console.error);
    </script>
</body>
</html>