<!DOCTYPE html>
<html>
<head>
    <title>Climate Adaptation Solutions Sunburst</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/plotly.js/2.24.1/plotly.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <style>
        body { margin: 0; padding: 20px; font-family: Arial, sans-serif; }
        #chart { width: 100%; height: 800px; }
    </style>
</head>
<body>
    <div id="chart"></div>

    <script>
        function wrapText(text, width = 50) {
            const words = text.split(' ');
            const lines = [];
            let currentLine = [];
            let currentLength = 0;

            for (const word of words) {
                if (currentLength + word.length + 1 <= width) {
                    currentLine.push(word);
                    currentLength += word.length + 1;
                } else {
                    lines.push(currentLine.join(' '));
                    currentLine = [word];
                    currentLength = word.length;
                }
            }
            lines.push(currentLine.join(' '));
            return lines.join('<br>');
        }

        async function loadData() {
            const response = await fetch('https://netzero-dev.github.io/Climate-Tech-Solutions-Map/climate_adaptation_solutions_full.csv');
            const text = await response.text();
            
            const data = Papa.parse(text, {
                header: true,
                skipEmptyLines: true
            }).data;

            // Fill missing values
            data.forEach(row => {
                row.Category = row.Category || 'Unknown Category';
                row.Climate_Problem = row.Climate_Problem || 'Unknown Climate Problem';
                row.Description = row.Description || 'No Description';
                row.Source = row.Source || 'Unknown Source';
                row.Wrapped_Source = wrapText(row.Source);
            });

            const plotData = [{
                type: 'sunburst',
                labels: [],
                parents: [],
                values: [],
                customdata: [],
                hovertemplate: '<b>%{label}</b><br><br>Source:<br>%{customdata}<extra></extra>',
                hoverlabel: {
                    bgcolor: 'white',
                    font: { size: 12 },
                    align: 'left'
                },
                insidetextorientation: 'radial',
                marker: {
                    colors: [
                        '#FFB3BA', '#BAFFC9', '#BAE1FF', '#FFFFBA', 
                        '#FFB3FF', '#FFE4B5', '#E6E6FA', '#B2DFDB', 
                        '#F0F4C3', '#FFCCBC'
                    ]
                }
            }];

            // Build hierarchy
            data.forEach((row, i) => {
                plotData[0].labels.push(row.Category);
                plotData[0].parents.push('');
                plotData[0].values.push(1);
                plotData[0].customdata.push(row.Wrapped_Source);

                plotData[0].labels.push(row.Climate_Problem);
                plotData[0].parents.push(row.Category);
                plotData[0].values.push(1);
                plotData[0].customdata.push(row.Wrapped_Source);

                const descLabel = row.Description.substring(0, 30) + '...';
                plotData[0].labels.push(descLabel);
                plotData[0].parents.push(row.Climate_Problem);
                plotData[0].values.push(1);
                plotData[0].customdata.push(row.Wrapped_Source);
            });

            const layout = {
                title: {
                    text: 'Climate Adaptation Solutions Hierarchy',
                    x: 0.5
                },
                width: 1200,
                height: 800,
                margin: { t: 50, l: 50, r: 50, b: 50 }
            };

            Plotly.newPlot('chart', plotData, layout);
        }

        loadData().catch(console.error);
    </script>
</body>
</html>