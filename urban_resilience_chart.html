<!DOCTYPE html>
<html>
<head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/plotly.js/2.24.1/plotly.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <style>
        #chart { width: 1200px; height: 800px; margin: 0 auto; }
    </style>
</head>
<body>
    <div id="chart"></div>

    <script>
        async function createVisualization() {
            const response = await fetch('https://netzero-dev.github.io/Climate-Tech-Solutions-Map/climate_adaptation_solutions_full.csv');
            const csvText = await response.text();
            
            const rawData = Papa.parse(csvText, {
                header: true,
                skipEmptyLines: true
            }).data;

            // Process data for visualization
            const labels = [];
            const parents = [];
            const values = [];
            const customdata = [];

            // Add root
            labels.push('Climate Solutions');
            parents.push('');
            values.push(rawData.length);
            customdata.push('Overview of climate adaptation solutions');

            // Process categories
            const categoryGroups = {};
            rawData.forEach(row => {
                if (!categoryGroups[row.Category]) {
                    categoryGroups[row.Category] = [];
                }
                categoryGroups[row.Category].push(row);
            });

            // Add categories and their solutions
            Object.entries(categoryGroups).forEach(([category, items]) => {
                // Add category
                if (category) {
                    labels.push(category);
                    parents.push('Climate Solutions');
                    values.push(items.length);
                    customdata.push(`${items.length} solutions`);

                    // Add solutions for this category
                    items.forEach(item => {
                        if (item.Solution_Name) {
                            labels.push(item.Solution_Name);
                            parents.push(category);
                            values.push(1);
                            customdata.push(
                                `<b>Source:</b> ${item.Source}<br>` +
                                `<b>Climate Problem:</b> ${item.Climate_Problem}<br>` +
                                `<b>Technologies:</b> ${item.Technologies}<br>` +
                                `<b>Description:</b> ${item.Description}`
                            );
                        }
                    });
                }
            });

            const data = [{
                type: 'sunburst',
                labels: labels,
                parents: parents,
                values: values,
                customdata: customdata,
                branchvalues: 'total',
                hovertemplate: '%{customdata}<extra></extra>',
                marker: {
                    colors: [
                        '#FFB3BA', '#BAFFC9', '#BAE1FF', '#FFFFBA', 
                        '#FFB3FF', '#FFE4B5', '#E6E6FA', '#B2DFDB'
                    ]
                }
            }];

            const layout = {
                title: 'Climate Adaptation Solutions',
                width: 1200,
                height: 800
            };

            Plotly.newPlot('chart', data, layout);
        }

        createVisualization().catch(console.error);
    </script>
</body>
</html>